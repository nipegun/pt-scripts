#!/bin/bash



# ----------
# Script de NiPeGun para probar contraseñas de un archivo rclone.conf cifrado
# usando un diccionario, con barra de progreso y ejecución paralela.
#
# Uso:
#   ./CrackRcloneConf.sh [ruta_diccionario.txt] [ruta_config.conf]
# ----------

vDiccionario="$1"
vConfCifrado="$2"

if [[ -z "$vDiccionario" || -z "$vConfCifrado" ]]; then
  echo "Uso: $0 [ruta_diccionario.txt] [ruta_config.conf]"
  exit 1
fi

if [[ ! -f "$vDiccionario" ]]; then
  echo "El archivo de diccionario '$vDiccionario' no existe."
  exit 2
fi

# Detectar cantidad de líneas (contraseñas)
vTotal=$(grep -cve '^\s*$' "$vDiccionario")
echo "[*] Probando $vTotal contraseñas..."
echo

# Función que prueba una contraseña
probar_contraseña() {
  vPass="$1"
  RCLONE_CONFIG_PASS="$vPass" rclone config show --config "$vConfCifrado" &>/dev/null
  if [[ $? -eq 0 ]]; then
    echo "[+] ¡Contraseña encontrada!: $vPass"
    pkill -P $$ 2>/dev/null
    exit 0
  fi
}

export -f probar_contraseña
export vConfCifrado

# Usamos pv para la barra de progreso y parallel para paralelismo
cat "$vDiccionario" | pv -pt -e -l -s "$vTotal" | parallel -j8 probar_contraseña {}

echo "[-] No se encontró la contraseña en el diccionario."
